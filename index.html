// Configurações do Supabase (Extraídas do seu sync_supabase.js)
const _supabase = supabase.createClient(
    'https://ywooulafmxwucedysuwa.supabase.co', 
    'sb_publishable_9GaW4k4aE5yUjTSTVBYF3g_NZy4Fy7Y'
);

async function carregarDados() {
    console.log("Iniciando busca de dados...");
    
    // 1. Busca Agenda
    const { data: agenda, error: err1 } = await _supabase
        .from('agenda')
        .select('*')
        .order('data_tarefa', { ascending: true });

    if (err1) console.error("Erro na Agenda:", err1);

    if (agenda) {
        const html = agenda.map(item => {
            // Ajuste para formatar data sem erro de fuso horário
            const dataFormatada = item.data_tarefa ? item.data_tarefa.split('-').reverse().join('/') : '---';
            return `
                <tr>
                    <td>${dataFormatada}</td>
                    <td>${item.obra || ''}</td>
                    <td>${item.tarefas || ''}</td>
                    <td class="status-${(item.status || '').toLowerCase()}">${item.status || ''}</td>
                </tr>
            `;
        }).join('');
        document.getElementById('tabela-agenda').innerHTML = html;
    }

    // 2. Busca Boletos
    const { data: boletos, error: err2 } = await _supabase
        .from('boletos')
        .select('*')
        .eq('status', 'Aberto')
        .order('vencimento', { ascending: true });

    if (err2) console.error("Erro nos Boletos:", err2);

    if (boletos) {
        const html = boletos.map(item => {
            const vencFormatado = item.vencimento ? item.vencimento.split('-').reverse().join('/') : '---';
            const valorFormatado = item.valor ? item.valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }) : 'R$ 0,00';
            return `
                <tr>
                    <td>${vencFormatado}</td>
                    <td>${item.fornecedor || ''}</td>
                    <td>${valorFormatado}</td>
                </tr>
            `;
        }).join('');
        document.getElementById('tabela-boletos').innerHTML = html;
    }
}

carregarDados();